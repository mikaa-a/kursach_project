{% extends "base.html" %}
{% block page_title %}Склады{% endblock %}
{% block head_scripts %}
<script src="{{ url_for('static', filename='js/phone-mask.js') }}?v=1"></script>
<script src="{{ url_for('static', filename='js/warehouses.js') }}?v=6" defer></script>
{% endblock %}
{% block content %}
<div class="actions-row">
  <a href="{{ url_for('admin_routes.distribution') }}" class="btn btn-primary">Отправить товар в магазин</a>
  <button type="button" class="btn btn-primary" onclick="whOpenAdd()">Добавить склад</button>
</div>
<div class="card">
  <table>
    <thead>
      <tr>
        <th>№</th>
        <th>название</th>
        <th>адрес</th>
        <th>телефон</th>
        <th>площадь</th>
        <th>остатки</th>
      </tr>
    </thead>
    <tbody>
      {% for w in warehouses_list %}
      <tr class="row-clickable" data-id="{{ w.id }}" onclick="whOpenEdit({{ w.id }})">
        <td>{{ w.id }}</td>
        <td>{{ w.name }}</td>
        <td>{{ w.address }}</td>
        <td>{{ w.phone }}</td>
        <td>{{ w.area }}</td>
        <td><a href="#" class="btn btn-sm btn-secondary btn-stock" data-id="{{ w.id }}" data-type="warehouse" data-title="{{ w.name|e }}" onclick="event.stopPropagation(); whOpenStock(this); return false;">остатки</a></td>
      </tr>
      {% endfor %}
      {% if not warehouses_list %}
      <tr><td colspan="6">Нет данных</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
<div id="modal-stock" class="modal-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:101; align-items:center; justify-content:center;">
  <div class="modal-content" style="background:#fff; padding:1.5rem; border-radius:0.5rem; max-width:560px; width:100%; margin:1rem;">
    <h3 id="modal-stock-title" style="margin-top:0;">Остатки</h3>
    <div class="card" style="margin-bottom:1rem;">
      <table>
        <thead>
          <tr><th>Наименование товара</th><th>Количество</th></tr>
        </thead>
        <tbody id="modal-stock-tbody"></tbody>
      </table>
    </div>
    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      <button type="button" class="btn btn-primary" onclick="whReceiptOpen()">Поступление</button>
      <button type="button" class="btn btn-secondary" onclick="whCloseStock()">Закрыть</button>
    </div>
  </div>
</div>
<div id="modal-receipt" class="modal-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:102; align-items:center; justify-content:center;">
  <div class="modal-content" style="background:#fff; padding:1.5rem; border-radius:0.5rem; max-width:420px; width:100%; margin:1rem;">
    <h3 id="modal-receipt-title" style="margin-top:0;">Поступление</h3>
    <div class="form-group"><label>Товар</label><select id="receipt-product"><option value="">— выберите товар —</option></select></div>
    <div class="form-group"><label>Количество</label><input id="receipt-quantity" type="number" min="1" value="1"></div>
    <p id="receipt-error" class="error" style="display:none;"></p>
    <div style="display:flex; gap:0.5rem;">
      <button type="button" class="btn btn-secondary" onclick="whReceiptCancel()">Отмена</button>
      <button type="button" class="btn btn-primary" onclick="whReceiptSubmit()">Оформить поступление</button>
    </div>
  </div>
</div>
<div id="modal-wh" class="modal-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:100;">
  <div class="modal-content" style="background:#fff; padding:1.5rem; border-radius:0.5rem; max-width:400px; width:100%;">
    <h3 id="modal-wh-title" style="margin-top:0;">Добавить склад</h3>
    <div class="form-group"><label>Название</label><input id="wh-name" type="text"></div>
    <div class="form-group"><label>Адрес</label><input id="wh-address" type="text"></div>
    <div class="form-group"><label>Телефон</label><input id="wh-phone" type="text" class="phone-input" placeholder="+7 (___) ___-__-__" maxlength="18"></div>
    <div class="form-group"><label>Площадь</label><input id="wh-area" type="number" step="0.01" value="0"></div>
    <p id="wh-error" class="error" style="display:none;"></p>
    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      <button type="button" class="btn btn-secondary" onclick="whCloseForm()">Отмена</button>
      <button type="button" class="btn btn-primary" onclick="whSave()">Сохранить</button>
      <button type="button" class="btn btn-danger" id="btn-wh-delete" style="display:none; margin-left:auto;" onclick="whDelete()">Удалить</button>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}{% endblock %}
